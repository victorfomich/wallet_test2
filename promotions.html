<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, minimal-ui" />
  <title>–ê–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã</title>
  <link rel="stylesheet" href="./styles.css" />
  <link rel="stylesheet" href="./promotions.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#2aabee" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí≥</text></svg>"> 
</head>
<body>
  <div id="app">
    <!-- Header with back button -->
    <header class="promotions-header">
      <button id="backBtn" class="back-btn" aria-label="–ù–∞–∑–∞–¥">
        <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true">
          <path d="M15 6L9 12l6 6" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <div class="header-title">–ê–∫—Ü–∏–∏ –∏ –ø—Ä–æ–º–æ–∫–æ–¥—ã</div>
    </header>

    <!-- Promotions Content -->
    <main class="promotions-content">
      <!-- Promo code input field -->
      <div class="promo-input-container">
        <input 
          type="text" 
          id="promoInput" 
          class="promo-input" 
          placeholder="–í–≤–µ–¥–∏ –ø—Ä–æ–º–æ–∫–æ–¥" 
          autocomplete="off"
          maxlength="50"
        />
        <button class="apply-btn" id="applyBtn" disabled>
          –ü—Ä–∏–º–µ–Ω–∏—Ç—å
        </button>
      </div>
    </main>
  </div>

  <script>
    // Back button functionality
    document.getElementById('backBtn').addEventListener('click', () => {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = 'profile.html';
      }
    });

    // Telegram WebApp back button
    try {
      const wa = window.Telegram?.WebApp;
      if (wa) {
        wa.BackButton?.show();
        wa.BackButton?.onClick(() => {
          document.getElementById('backBtn').click();
        });
      }
    } catch(e) {
      console.log('Telegram WebApp not available');
    }

    // Promo code input handling
    document.addEventListener('DOMContentLoaded', () => {
      const promoInput = document.getElementById('promoInput');
      const applyBtn = document.getElementById('applyBtn');
      
      // Update button state based on input
      function updateButtonState() {
        const promoCode = promoInput.value.trim();
        const isValid = promoCode.length > 0;
        
        applyBtn.disabled = !isValid;
        applyBtn.classList.toggle('active', isValid);
      }
      
      // Input event listeners
      promoInput.addEventListener('input', updateButtonState);
      promoInput.addEventListener('blur', updateButtonState);
      promoInput.addEventListener('focus', updateButtonState);
      
      // Apply button click handler
      applyBtn.addEventListener('click', async () => {
        if (applyBtn.disabled) return;
        
        const promoCode = promoInput.value.trim();
        
        // Add haptic feedback
        try {
          window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('medium');
        } catch(e) {}
        
        // Disable button and show loading state
        applyBtn.disabled = true;
        applyBtn.textContent = '–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è...';
        
        try {
          // Simulate API call (in real app, this would be a real API call)
          await new Promise(resolve => setTimeout(resolve, 1500));
          
          // Show success state briefly
          applyBtn.textContent = '–ü—Ä–∏–º–µ–Ω–µ–Ω–æ!';
          applyBtn.classList.add('success');
          
          // Reset after 2 seconds
          setTimeout(() => {
            applyBtn.textContent = '–ü—Ä–∏–º–µ–Ω–∏—Ç—å';
            applyBtn.classList.remove('success');
            applyBtn.disabled = false;
            promoInput.value = '';
            updateButtonState();
          }, 2000);
          
        } catch (error) {
          console.log('Failed to apply promo code:', error);
          
          // Show error state briefly
          applyBtn.textContent = '–û—à–∏–±–∫–∞';
          applyBtn.classList.add('error');
          
          // Reset after 2 seconds
          setTimeout(() => {
            applyBtn.textContent = '–ü—Ä–∏–º–µ–Ω–∏—Ç—å';
            applyBtn.classList.remove('error');
            applyBtn.disabled = false;
            updateButtonState();
          }, 2000);
        }
      });
      
      // Focus on promo input when page loads
      promoInput.focus();
    });
  </script>
</body>
</html>
